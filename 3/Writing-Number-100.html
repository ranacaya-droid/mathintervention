<!DOCTYPE html>
<html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImExZWJmY2U1ZjYwZWY5Y2NkMGViNTc3ZmI3ZjkxZGRjODg1MDA0YzAiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIxNzA4MTcxMjk2MzYwODYxMTQxNCIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjXzc1NjQ3ZTM3YjQ1MzQzZWJfbW9uc3Rlcl9tYXRoX2FwcF8wMS04ODYifSwiZXhwIjoxNzU2MTcyMjAxLCJpYXQiOjE3NTYxNjg2MDEsImFsZyI6IlJTMjU2In0.QH7cLAskSCbB2oXfHbqcRImxpQn28-7qMuGY3L0BSnxmTtsV97jA5gNhwK1jh8_VW4_F09s3VGFzZdKaOfqT0v8LUw9wF9lL3jfQ9aNNDELEkar1Ayw_JNOuKoKfD7vDtYr5qmzxOarfV7t95eqROA8LvEvTJymUTGCfRNXQZBWcrG1bQIpS-FuV1rpxK8ODO62Wj3Q6_ZihmJLgbauyfPNk48SY4832jzS7Kxt7MBfPpdchtVemJqFjZgI7ZyrB9DZ-gEnAukMS_HHg9J0Ca_Ela2UUhTXO-8iXpUA_SBxlIL3_-WbjaQf8ZnWMMCuVdW32kBrL_ciCH7U2BLcIVw","c_75647e37b45343eb_monster_math_app_01-886")</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-05-20","imageModelName":"imagen-3.0-generate-002","imageEditModelName":"gemini-2.0-flash-preview-image-generation","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Math: Numbers to 100</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&display=swap');
        body {
            font-family: 'Quicksand', sans-serif;
            overscroll-behavior: none;
        }
        .tab-active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            border-bottom-color: transparent;
        }
        .no-select {
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari, Chrome, Opera, Edge */
            -khtml-user-select: none; /* Konqueror HTML */
            -moz-user-select: none; /* Old versions of Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently supported by Chrome, Opera and Firefox */
        }
        .dragging {
            opacity: 0.5;
            transform: scale(1.1);
        }
        .drop-target-hover {
            border: 2px dashed #3b82f6;
            background-color: #bfdbfe;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.sticky{position:sticky}.bottom-2{bottom:0.5rem}.top-2{top:0.5rem}.z-10{z-index:10}.mx-auto{margin-left:auto;margin-right:auto}.mb-4{margin-bottom:1rem}.mt-4{margin-top:1rem}.mb-2{margin-bottom:0.5rem}.flex{display:flex}.hidden{display:none}.min-h-screen{min-height:100vh}.max-w-4xl{max-width:56rem}.flex-grow{flex-grow:1}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-4{gap:1rem}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.rounded-t-lg{border-top-left-radius:0.5rem;border-top-right-radius:0.5rem}.border-b-2{border-bottom-width:2px}.border-l-4{border-left-width:4px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.p-2{padding:0.5rem}.p-4{padding:1rem}.p-3{padding:0.75rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.text-left{text-align:left}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.font-bold{font-weight:700}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-orange-500{--tw-text-opacity:1;color:rgb(249 115 22 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-purple-600{--tw-text-opacity:1;color:rgb(147 51 234 / var(--tw-text-opacity, 1))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-400:hover{--tw-bg-opacity:1;background-color:rgb(156 163 175 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-green-600:hover{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:opacity-50:disabled{opacity:0.5}@media (min-width: 640px){.sm\:flex-row{flex-direction:row}.sm\:p-4{padding:1rem}.sm\:p-8{padding:2rem}.sm\:text-3xl{font-size:1.875rem;line-height:2.25rem}}</style></head>
<body class="bg-gray-100 antialiased">

    <div id="app-container" class="max-w-4xl mx-auto p-2 sm:p-4 min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white rounded-xl shadow-md p-4 mb-4 sticky top-2 z-10">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                <h1 class="text-2xl sm:text-3xl font-bold text-blue-600">ðŸ‘¹ Monster Math</h1>
                <div id="mode-switcher" class="flex gap-2"><button data-action="switch-mode" data-mode="practice" class="px-4 py-2 bg-green-500 text-white font-bold rounded-lg shadow hover:bg-green-600 transition-all">Go to Practice ðŸ‘¾</button><button data-action="download-work" class="px-4 py-2 bg-gray-500 text-white font-bold rounded-lg shadow hover:bg-gray-600 transition-all">Save HTML</button></div>
            </div>
            <nav id="day-tabs" class="mt-4 flex flex-wrap border-b-2 border-gray-200"><button data-action="set-day" data-day="1" class="day-tab-btn flex-grow text-center font-bold p-3 rounded-t-lg transition-all tab-active ">Day 1</button><button data-action="set-day" data-day="2" class="day-tab-btn flex-grow text-center font-bold p-3 rounded-t-lg transition-all text-gray-500 hover:bg-gray-200 ">Day 2</button><button data-action="set-day" data-day="3" class="day-tab-btn flex-grow text-center font-bold p-3 rounded-t-lg transition-all text-gray-500 hover:bg-gray-200 ">Day 3</button><button data-action="set-day" data-day="4" class="day-tab-btn flex-grow text-center font-bold p-3 rounded-t-lg transition-all text-gray-500 hover:bg-gray-200 ">Day 4</button></nav>
        </header>

        <!-- Main Content Area -->
        <main id="content-area" class="flex-grow bg-white rounded-xl shadow-md p-4 sm:p-8">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-purple-600 mb-2">Monster Mash Place Value!</h2>
                        <p class="text-lg text-gray-600 mb-4">Standard: 3.NR.1.1 (subset): Represent whole numbers up to 100.</p>
                        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg text-left">
                            <h3 class="font-bold text-xl mb-2">Today's Goals:</h3>
                            <ul class="list-disc list-inside">
                                <li>Students will be able to identify the value of digits in the tens and ones place.</li><li>Students will be able to represent two-digit numbers using base-ten blocks.</li><li>I can show numbers using tens and ones.</li>
                            </ul>
                        </div>
                    </div></main>

        <!-- Footer with Navigation -->
        <footer id="footer-nav" class="bg-white rounded-xl shadow-md p-4 mt-4 sticky bottom-2 z-10">
             <div class="flex justify-between items-center">
                <button id="prev-btn" data-action="prev-slide" class="px-6 py-3 bg-gray-300 text-gray-700 font-bold rounded-lg shadow hover:bg-gray-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled="">Previous</button>
                <div id="streak-counter" class="text-xl font-bold text-orange-500 hidden">ðŸ”¥ Streak: 0</div>
                <button id="next-btn" data-action="next-slide" class="px-6 py-3 bg-blue-500 text-white font-bold rounded-lg shadow hover:bg-blue-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
            </div>
        </footer>
    </div>

    <!-- Embedded Progress Data (for saved files) -->
    <!-- <script id="progress-data" type="application/json"> ... </script> -->

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CORE APPLICATION LOGIC ---

    // --- DATA BLUEPRINT ---
    const lessonBlueprint = {
        // This object will be populated with the full JSON from Phase 1.
        // The structure is { "day1": { "lesson": {...}, "practice": {...} }, "day2": ... }
    };

    // --- SVG GENERATION ---
    function generateVisual(visualObject) {
        if (!visualObject || visualObject.type === 'none') {
            return null;
        }

        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute('class', 'w-full h-auto my-4 max-h-64');
        svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');

        const { type, description } = visualObject;
        
        switch (type) {
            case 'base-ten-blocks': {
                let num = parseInt(description.match(/\d+/)[0]);
                const hundreds = Math.floor(num / 100);
                num %= 100;
                const tens = Math.floor(num / 10);
                const ones = num % 10;

                let totalWidth = hundreds * 110 + tens * 15 + ones * 15;
                let maxHeight = 100;
                let currentX = 10;

                svg.setAttribute('viewBox', `0 0 ${Math.max(totalWidth, 200)} ${maxHeight + 20}`);

                // Draw hundreds
                for (let i = 0; i < hundreds; i++) {
                    const g = document.createElementNS(svgNS, 'g');
                    const rect = document.createElementNS(svgNS, 'rect');
                    rect.setAttribute('x', currentX);
                    rect.setAttribute('y', 10);
                    rect.setAttribute('width', 100);
                    rect.setAttribute('height', 100);
                    rect.setAttribute('fill', '#fde047'); // yellow-300
                    rect.setAttribute('stroke', '#facc15'); // yellow-400
                    rect.setAttribute('stroke-width', '2');
                    g.appendChild(rect);
                    svg.appendChild(g);
                    currentX += 110;
                }

                // Draw tens
                for (let i = 0; i < tens; i++) {
                    const g = document.createElementNS(svgNS, 'g');
                    const rect = document.createElementNS(svgNS, 'rect');
                    rect.setAttribute('x', currentX);
                    rect.setAttribute('y', 10);
                    rect.setAttribute('width', 10);
                    rect.setAttribute('height', 100);
                    rect.setAttribute('fill', '#60a5fa'); // blue-400
                    rect.setAttribute('stroke', '#3b82f6'); // blue-500
                    rect.setAttribute('stroke-width', '2');
                    g.appendChild(rect);
                    svg.appendChild(g);
                    currentX += 15;
                }

                // Draw ones
                let onesX = currentX;
                let onesY = 10;
                for (let i = 0; i < ones; i++) {
                    const g = document.createElementNS(svgNS, 'g');
                    const rect = document.createElementNS(svgNS, 'rect');
                    rect.setAttribute('x', onesX);
                    rect.setAttribute('y', onesY);
                    rect.setAttribute('width', 10);
                    rect.setAttribute('height', 10);
                    rect.setAttribute('fill', '#86efac'); // green-300
                    rect.setAttribute('stroke', '#4ade80'); // green-400
                    rect.setAttribute('stroke-width', '1');
                    g.appendChild(rect);
                    svg.appendChild(g);
                    onesY += 12;
                    if ( (i + 1) % 5 === 0) {
                        onesY = 10;
                        onesX += 12;
                    }
                }
                break;
            }
            case 'place-value-chart': {
                const parts = description.match(/(\d+) in hundreds, (\d+) in tens, (\d+) in ones/);
                const [, h, t, o] = parts;
                
                svg.setAttribute('viewBox', '0 0 320 100');
                
                const createText = (x, y, text, size = '16', weight = 'normal') => {
                    const el = document.createElementNS(svgNS, 'text');
                    el.setAttribute('x', x);
                    el.setAttribute('y', y);
                    el.setAttribute('font-size', size);
                    el.setAttribute('font-weight', weight);
                    el.setAttribute('text-anchor', 'middle');
                    el.setAttribute('dominant-baseline', 'middle');
                    el.textContent = text;
                    return el;
                };

                // Headers
                svg.appendChild(createText(60, 20, 'Hundreds', '14', 'bold'));
                svg.appendChild(createText(160, 20, 'Tens', '14', 'bold'));
                svg.appendChild(createText(260, 20, 'Ones', '14', 'bold'));
                
                // Values
                svg.appendChild(createText(60, 65, h, '36', 'bold'));
                svg.appendChild(createText(160, 65, t, '36', 'bold'));
                svg.appendChild(createText(260, 65, o, '36', 'bold'));

                // Lines
                const createLine = (x1, y1, x2, y2) => {
                    const line = document.createElementNS(svgNS, 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('stroke', '#9ca3af'); // gray-400
                    line.setAttribute('stroke-width', '2');
                    return line;
                };
                svg.appendChild(createLine(10, 40, 310, 40));
                svg.appendChild(createLine(110, 10, 110, 90));
                svg.appendChild(createLine(210, 10, 210, 90));
                break;
            }
            case 'highlighted-number': {
                const parts = description.match(/number (\d+) with the digit (\d+)/);
                const [, fullNum, highlightedDigit] = parts;
                
                svg.setAttribute('viewBox', `0 0 ${fullNum.length * 50} 100`);
                
                const textEl = document.createElementNS(svgNS, 'text');
                textEl.setAttribute('x', '50%');
                textEl.setAttribute('y', '50%');
                textEl.setAttribute('font-size', '60');
                textEl.setAttribute('font-weight', 'bold');
                textEl.setAttribute('text-anchor', 'middle');
                textEl.setAttribute('dominant-baseline', 'middle');
                
                const digitIndex = fullNum.indexOf(highlightedDigit);
                if (digitIndex !== -1) {
                    const rect = document.createElementNS(svgNS, 'rect');
                    rect.setAttribute('x', `${digitIndex * 40 + 5}`);
                    rect.setAttribute('y', '20');
                    rect.setAttribute('width', '40');
                    rect.setAttribute('height', '60');
                    rect.setAttribute('fill', '#fef08a'); // yellow-200
                    rect.setAttribute('rx', '8');
                    svg.appendChild(rect);
                }
                textEl.textContent = fullNum;
                svg.appendChild(textEl);
                break;
            }
            case 'comparison': {
                 // Example: "25 and 52"
                const numbers = description.match(/\d+/g);
                if(numbers && numbers.length >= 2) {
                    svg.setAttribute('viewBox', '0 0 300 100');
                    const createText = (x, y, text) => {
                        const el = document.createElementNS(svgNS, 'text');
                        el.setAttribute('x', x);
                        el.setAttribute('y', y);
                        el.setAttribute('font-size', '48');
                        el.setAttribute('font-weight', 'bold');
                        el.setAttribute('text-anchor', 'middle');
                        el.setAttribute('dominant-baseline', 'middle');
                        el.textContent = text;
                        return el;
                    };
                    svg.appendChild(createText(60, 50, numbers[0]));
                    svg.appendChild(createText(240, 50, numbers[1]));
                    
                    const box = document.createElementNS(svgNS, 'rect');
                    box.setAttribute('x', 125);
                    box.setAttribute('y', 25);
                    box.setAttribute('width', 50);
                    box.setAttribute('height', 50);
                    box.setAttribute('fill', 'none');
                    box.setAttribute('stroke', '#cbd5e1'); // gray-300
                    box.setAttribute('stroke-width', '2');
                    box.setAttribute('rx', '5');
                    svg.appendChild(box);
                }
                break;
            }
        }

        return svg;
    }

    // --- STATE MANAGEMENT ---
    let appState = {};
    let currentSlideData = null; // Holds data for the currently displayed slide/question
    let draggedElement = null; // For drag and drop

    const defaultState = {
        currentDay: 1,
        currentMode: 'lesson', // 'lesson' or 'practice'
        currentSlide: 0,
        streak: 0,
        lessonProgress: { 1: 0, 2: 0, 3: 0, 4: 0 },
        practice: {
            currentLevel: null,
            1: { 1: { progress: 0, answers: {} }, 2: { progress: 0, answers: {} }, 3: { progress: 0, answers: {} } },
            2: { 1: { progress: 0, answers: {} }, 2: { progress: 0, answers: {} }, 3: { progress: 0, answers: {} } },
            3: { 1: { progress: 0, answers: {} }, 2: { progress: 0, answers: {} }, 3: { progress: 0, answers: {} } },
            4: { 1: { progress: 0, answers: {} }, 2: { progress: 0, answers: {} }, 3: { progress: 0, answers: {} } },
        }
    };

    function saveState() {
        try {
            localStorage.setItem('monsterMathProgress', JSON.stringify(appState));
        } catch (e) {
            console.error("Could not save state to localStorage:", e);
        }
    }

    function loadState() {
        const embeddedDataEl = document.getElementById('progress-data');
        if (embeddedDataEl) {
            try {
                const data = JSON.parse(embeddedDataEl.textContent);
                appState = { ...defaultState, ...data };
                console.log("State loaded from embedded data.");
                return;
            } catch (e) {
                console.error("Could not parse embedded progress data:", e);
            }
        }
        
        try {
            const savedState = localStorage.getItem('monsterMathProgress');
            if (savedState) {
                appState = { ...defaultState, ...JSON.parse(savedState) };
                console.log("State loaded from localStorage.");
            } else {
                appState = JSON.parse(JSON.stringify(defaultState)); // Deep copy
                console.log("No saved state found, using default.");
            }
        } catch (e) {
            console.error("Could not load state from localStorage:", e);
            appState = JSON.parse(JSON.stringify(defaultState));
        }
    }

    // --- INITIALIZATION ---
    function initializeApp() {
        // Populate the lessonBlueprint with the actual data
        const fullBlueprint = {
            "day1": {
                "lesson": {
                    "title": "Monster Mash Place Value!",
                    "standard": "3.NR.1.1 (subset): Represent whole numbers up to 100.",
                    "objectives": ["Students will be able to identify the value of digits in the tens and ones place.", "Students will be able to represent two-digit numbers using base-ten blocks.", "I can show numbers using tens and ones."],
                    "vocabulary": { "Place Value": "The value of a digit based on its position in a number.", "Digit": "Any of the numerals from 0 to 9.", "Tens": "The place value representing groups of ten." },
                    "hook": { "description": "Show a picture of a monster holding two jars of googly eyes. One jar is labeled 'Groups of 10' and the other 'Ones'. Ask students: 'If our monster has 3 jars of 10 and 4 single eyes, how many eyes does he have in total? How do you know?'", "questions": ["How can we count big numbers quickly?", "What does the '2' in the number 25 really mean?"] },
                    "i_do": [
                        { "id": "d1_i_do_1", "type": "demonstration", "prompt": "Model the number 42 with base-ten blocks on the board. Think aloud: 'I see the number 42. The digit 4 is in the tens place, so I need four tens rods. One, two, three, four. That's 10, 20, 30, 40. The digit 2 is in the ones place, so I need two ones cubes. One, two. So, 42 is four tens and two ones.'", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 42."} },
                        { "id": "d1_i_do_2", "type": "demonstration", "prompt": "Draw a place value chart. Write the number 67. Think aloud: 'In the number 67, I ask myself, which digit is in the tens place? It's the 6. So I write a 6 in the tens column. Which is in the ones place? The 7. I write a 7 in the ones column. This shows me 67 is 6 tens and 7 ones.'", "visual": {"type": "place-value-chart", "description": "A place value chart with 0 in hundreds, 6 in tens, 7 in ones."} },
                        { "id": "d1_i_do_3", "type": "demonstration", "prompt": "Show the number 30. Think aloud: 'This is an interesting one. The 3 is in the tens place, so that's three tens rods. But the 0 is in the ones place. That means there are zero ones! So 30 is just three groups of ten.'", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 30."} }
                    ],
                    "we_do": [
                        { "id": "d1_w_do_1", "type": "mc", "prompt": "Which number is shown by 5 tens and 3 ones?", "visual": {"type": "none", "description": "5 tens and 3 ones"}, "data": {"options": ["35", "53", "503"]}, "correct": "53" },
                        { "id": "d1_w_do_2", "type": "mc", "prompt": "What is the value of the digit 8 in the number 81?", "visual": {"type": "highlighted-number", "description": "The number 81 with the digit 8 highlighted."}, "data": {"options": ["8", "80", "1"]}, "correct": "80" },
                        { "id": "d1_w_do_3", "type": "mc", "prompt": "How many ones are in the number 29?", "visual": {"type": "none", "description": "The number 29."}, "data": {"options": ["2", "9", "20"]}, "correct": "9" },
                        { "id": "d1_w_do_4", "type": "mc", "prompt": "A monster has 7 tens rods and 0 ones cubes. What number does he have?", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 70."}, "data": {"options": ["7", "70", "77"]}, "correct": "70" },
                        { "id": "d1_w_do_5", "type": "mc", "prompt": "Look at the number 94. What does the 9 stand for?", "visual": {"type": "highlighted-number", "description": "The number 94 with the digit 9 highlighted."}, "data": {"options": ["9 ones", "9 hundreds", "9 tens"]}, "correct": "9 tens" },
                        { "id": "d1_w_do_6", "type": "mc", "prompt": "Which number has 2 in the tens place and 6 in the ones place?", "visual": {"type": "place-value-chart", "description": "A place value chart with 0 in hundreds, 2 in tens, 6 in ones."}, "data": {"options": ["62", "26", "206"]}, "correct": "26" },
                        { "id": "d1_w_do_7", "type": "mc", "prompt": "What number do these blocks show?", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 33."}, "data": {"options": ["33", "6", "303"]}, "correct": "33" },
                        { "id": "d1_w_do_8", "type": "mc", "prompt": "In the number 15, what is the value of the 1?", "visual": {"type": "highlighted-number", "description": "The number 15 with the digit 1 highlighted."}, "data": {"options": ["1", "10", "5"]}, "correct": "10" },
                        { "id": "d1_w_do_9", "type": "mc", "prompt": "A monster has 4 bags with 10 candies each and 5 loose candies. How many candies in total?", "visual": {"type": "none", "description": "4 groups of 10 and 5 ones."}, "data": {"options": ["45", "54", "9"]}, "correct": "45" },
                        { "id": "d1_w_do_10", "type": "mc", "prompt": "Which number is the same as sixty-one?", "visual": {"type": "none", "description": "The words sixty-one."}, "data": {"options": ["16", "61", "601"]}, "correct": "61" }
                    ],
                    "you_do": [
                        { "id": "d1_y_do_1", "type": "text-box", "prompt": "Draw base-ten blocks to show the number 58. How many tens did you draw?", "visual": {"type": "none", "description": "The number 58."}, "data": {"size": 5}, "correct": "5" },
                        { "id": "d1_y_do_2", "type": "text-box", "prompt": "Write the number that has 9 tens and 2 ones.", "visual": {"type": "none", "description": "9 tens and 2 ones."}, "data": {"size": 5}, "correct": "92" },
                        { "id": "d1_y_do_3", "type": "text-box", "prompt": "In the number 77, what is the value of the underlined digit: 7_?", "visual": {"type": "none", "description": "The number 77 with the ones digit underlined."}, "data": {"size": 5}, "correct": "7" },
                        { "id": "d1_y_do_4", "type": "text-box", "prompt": "A monster says he has 3 ones and 8 tens. What number is he thinking of?", "visual": {"type": "none", "description": "3 ones and 8 tens."}, "data": {"size": 5}, "correct": "83" },
                        { "id": "d1_y_do_5", "type": "text-box", "prompt": "Look at a pile of 2 tens rods and 14 ones cubes. What is the total number?", "visual": {"type": "none", "description": "2 tens and 14 ones."}, "data": {"size": 5}, "correct": "34" }
                    ],
                    "closure": { "description": "Review the 'I can' statement: 'I can show numbers using tens and ones.' Ask students to turn to a partner and explain how they would show the number 62 to a friendly monster who doesn't understand place value.", "exit_ticket": "On a sticky note, draw a picture of base-ten blocks to represent the number 37." },
                    "materials": ["Whiteboard/Smartboard", "Markers", "Base-ten blocks (physical or digital)", "Place value chart anchor chart", "Sticky notes"]
                },
                "practice": {
                    "level1": [
                        {"id": "d1_l1_q1", "type": "mc", "prompt": "Which number has 3 tens and 5 ones?", "visual": {"type": "none", "description": "3 tens and 5 ones."}, "data": {"options": ["53", "35", "305"]}, "correct": "35"},
                        {"id": "d1_l1_q2", "type": "mc", "prompt": "What number do these blocks show?", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 24."}, "data": {"options": ["24", "42", "6"]}, "correct": "24"},
                        {"id": "d1_l1_q3", "type": "mc", "prompt": "In the number 62, the digit 6 is in the ___ place.", "visual": {"type": "highlighted-number", "description": "The number 62 with the digit 6 highlighted."}, "data": {"options": ["ones", "tens", "hundreds"]}, "correct": "tens"},
                        {"id": "d1_l1_q4", "type": "mc", "prompt": "How many tens are in the number 50?", "visual": {"type": "none", "description": "The number 50."}, "data": {"options": ["0", "5", "50"]}, "correct": "5"},
                        {"id": "d1_l1_q5", "type": "mc", "prompt": "What is the value of the digit 9 in the number 9?", "visual": {"type": "none", "description": "The number 9."}, "data": {"options": ["9", "90", "0"]}, "correct": "9"},
                        {"id": "d1_l1_q6", "type": "mc", "prompt": "Which number is shown in the chart?", "visual": {"type": "place-value-chart", "description": "A place value chart with 0 in hundreds, 7 in tens, 1 in ones."}, "data": {"options": ["17", "71", "701"]}, "correct": "71"},
                        {"id": "d1_l1_q7", "type": "mc", "prompt": "Choose the number for 'four tens'.", "visual": {"type": "none", "description": "The words 'four tens'."}, "data": {"options": ["4", "40", "14"]}, "correct": "40"},
                        {"id": "d1_l1_q8", "type": "mc", "prompt": "What number do these blocks show?", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 18."}, "data": {"options": ["81", "9", "18"]}, "correct": "18"},
                        {"id": "d1_l1_q9", "type": "mc", "prompt": "In the number 33, the second 3 has a value of...", "visual": {"type": "none", "description": "The number 33."}, "data": {"options": ["3", "30", "300"]}, "correct": "3"},
                        {"id": "d1_l1_q10", "type": "mc", "prompt": "Which number has 8 in the ones place?", "visual": {"type": "none", "description": "A number with 8 in the ones place."}, "data": {"options": ["81", "18", "8"]}, "correct": "18"},
                        {"id": "d1_l1_q11", "type": "true-false", "prompt": "The number 45 has 5 tens and 4 ones.", "visual": {"type": "none", "description": "The number 45."}, "data": {"options": ["True", "False"]}, "correct": "False"},
                        {"id": "d1_l1_q12", "type": "true-false", "prompt": "The value of the 7 in 72 is 70.", "visual": {"type": "highlighted-number", "description": "The number 72 with the digit 7 highlighted."}, "data": {"options": ["True", "False"]}, "correct": "True"},
                        {"id": "d1_l1_q13", "type": "true-false", "prompt": "These blocks show the number 31.", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 13."}, "data": {"options": ["True", "False"]}, "correct": "False"},
                        {"id": "d1_l1_q14", "type": "true-false", "prompt": "The number 90 has nine tens and zero ones.", "visual": {"type": "none", "description": "The number 90."}, "data": {"options": ["True", "False"]}, "correct": "True"},
                        {"id": "d1_l1_q15", "type": "true-false", "prompt": "In the number 28, the 2 has a greater value than the 8.", "visual": {"type": "none", "description": "The number 28."}, "data": {"options": ["True", "False"]}, "correct": "True"},
                        {"id": "d1_l1_q16", "type": "drag-drop-match", "prompt": "Match the number to its tens and ones.", "visual": {"type": "none", "description": "Matching numbers to place value descriptions."}, "data": {"draggables": ["47", "74"], "dropTargets": ["4 tens, 7 ones", "7 tens, 4 ones"]}, "correct": {"47": "4 tens, 7 ones", "74": "7 tens, 4 ones"}},
                        {"id": "d1_l1_q17", "type": "drag-drop-match", "prompt": "Match the blocks to the number.", "visual": {"type": "none", "description": "Matching base-ten blocks to numbers."}, "data": {"draggables": ["Image of 25", "Image of 52"], "dropTargets": ["52", "25"]}, "correct": {"Image of 25": "25", "Image of 52": "52"}},
                        {"id": "d1_l1_q18", "type": "drag-drop-match", "prompt": "Match the value to the digit's place.", "visual": {"type": "none", "description": "Matching values to place values."}, "data": {"draggables": ["The 8 in 80", "The 8 in 18"], "dropTargets": ["8", "80"]}, "correct": {"The 8 in 80": "80", "The 8 in 18": "8"}},
                        {"id": "d1_l1_q19", "type": "drag-drop-match", "prompt": "Match the number to its description.", "visual": {"type": "none", "description": "Matching numbers to descriptions."}, "data": {"draggables": ["90", "9"], "dropTargets": ["Nine ones", "Nine tens"]}, "correct": {"90": "Nine tens", "9": "Nine ones"}},
                        {"id": "d1_l1_q20", "type": "drag-drop-match", "prompt": "Match the number to the chart.", "visual": {"type": "none", "description": "Matching numbers to place value charts."}, "data": {"draggables": ["Chart for 36", "Chart for 63"], "dropTargets": ["63", "36"]}, "correct": {"Chart for 36": "36", "Chart for 63": "63"}}
                    ],
                    "level2": [
                        {"id": "d1_l2_q1", "type": "mc", "prompt": "A monster has 3 tens rods and 15 ones cubes. What number does this represent?", "visual": {"type": "none", "description": "3 tens and 15 ones."}, "data": {"options": ["315", "35", "45"]}, "correct": "45"},
                        {"id": "d1_l2_q2", "type": "mc", "prompt": "Which number has a digit in the tens place that is double the digit in the ones place?", "visual": {"type": "none", "description": "Tens digit is double the ones digit."}, "data": {"options": ["24", "42", "36"]}, "correct": "42"},
                        {"id": "d1_l2_q3", "type": "mc", "prompt": "I am a number between 40 and 50. I have 6 ones. What number am I?", "visual": {"type": "none", "description": "A number riddle."}, "data": {"options": ["46", "56", "64"]}, "correct": "46"},
                        {"id": "d1_l2_q4", "type": "mc", "prompt": "If you add one ten to the number 58, what is the new number?", "visual": {"type": "base-ten-blocks", "description": "Base-ten blocks showing the number 58."}, "data": {"options": ["59", "68", "158"]}, "correct": "68"},
                        {"id": "d1_l2_q5", "type": "mc", "prompt": "What is the difference in value between the two 5s in the number 55?", "visual": {"type": "none", "description": "The number 55."}, "data": {"options": ["0", "50", "45"]}, "correct": "45"},
                        {"id": "d1_l2_q6", "type": "multi-select", "prompt": "Select all the ways to represent the number 63.", "visual": {"type": "none", "description": "Representing 63."}, "data": {"options": ["6 tens, 3 ones", "5 tens, 13 ones", "63 ones", "3 tens, 6 ones"]}, "correct": ["6 tens, 3 ones", "5 tens, 13 ones", "63 ones"]},
                        {"id": "d1_l2_q7", "type": "multi-select", "prompt": "Which numbers have a 4 in the tens place?", "visual": {"type": "none", "description": "Numbers with 4 in the tens place."}, "data": {"options": ["41", "14", "49", "4"]}, "correct": ["41", "49"]},
                        {"id": "d1_l2_q8", "type": "multi-select", "prompt": "Choose all numbers where the value of the ones digit is greater than the value of the tens digit.", "visual": {"type": "none", "description": "Ones digit value > tens digit value."}, "data": {"options": ["19", "21", "34", "82"]}, "correct": ["19"]},
                        {"id": "d1_l2_q9", "type": "multi-select", "prompt": "A monster has a secret number. The tens digit is 2 more than the ones digit. The sum of the digits is 8. Select all numbers it could be.", "visual": {"type": "none", "description": "A number riddle."}, "data": {"options": ["26", "62", "53", "35"]}, "correct": ["53"]},
                        {"id": "d1_l2_q10", "type": "multi-select", "prompt": "Select all numbers that have 0 ones.", "visual": {"type": "none", "description": "Numbers with 0 ones."}, "data": {"options": ["100", "10", "1", "70"]}, "correct": ["100", "10", "70"]},
                        {"id": "d1_l2_q11", "type": "text-box", "prompt": "How many tens are in the number 99?", "visual": {"type": "none", "description": "The number 99."}, "data": {"size": 5}, "correct": "9"},
                        {"id": "d1_l2_q12", "type": "text-box", "prompt": "I have 8 tens and 12 ones. What number am I?", "visual": {"type": "none", "description": "8 tens and 12 ones."}, "data": {"size": 5}, "correct": "92"},
                        {"id": "d1_l2_q13", "type": "text-box", "prompt": "Write a 2-digit number where the tens digit is 5 more than the ones digit.", "visual": {"type": "none", "description": "A number riddle."}, "data": {"size": 5}, "correct": "50"},
                        {"id": "d1_l2_q14", "type": "text-box", "prompt": "What number is 10 less than 75?", "visual": {"type": "none", "description": "10 less than 75."}, "data": {"size": 5}, "correct": "65"},
                        {"id": "d1_l2_q15", "type": "text-box", "prompt": "Combine 2 tens and 3 tens and 4 ones. What is the total?", "visual": {"type": "none", "description": "Combining place values."}, "data": {"size": 5}, "correct": "54"},
                        {"id": "d1_l2_q16", "type": "drag-drop-sort", "prompt": "Sort the numbers into the correct monster dens.", "visual": {"type": "none", "description": "Sorting numbers by tens digit."}, "data": {"items": ["23", "58", "29", "51"], "categories": ["Tens digit is 2", "Tens digit is 5"]}, "correct": {"Tens digit is 2": ["23", "29"], "Tens digit is 5": ["58", "51"]}},
                        {"id": "d1_l2_q17", "type": "drag-drop-sort", "prompt": "Sort the descriptions.", "visual": {"type": "none", "description": "Sorting descriptions by value."}, "data": {"items": ["4 tens, 2 ones", "2 tens, 4 ones", "42 ones", "24 ones"], "categories": ["Value is 42", "Value is 24"]}, "correct": {"Value is 42": ["4 tens, 2 ones", "42 ones"], "Value is 24": ["2 tens, 4 ones", "24 ones"]}},
                        {"id": "d1_l2_q18", "type": "drag-drop-sort", "prompt": "Sort the numbers based on their ones digit.", "visual": {"type": "none", "description": "Sorting by ones digit."}, "data": {"items": ["18", "81", "88", "11"], "categories": ["Ones digit is 1", "Ones digit is 8"]}, "correct": {"Ones digit is 1": ["81", "11"], "Ones digit is 8": ["18", "88"]}},
                        {"id": "d1_l2_q19", "type": "drag-drop-sort", "prompt": "Help the monster sort his number blocks.", "visual": {"type": "none", "description": "Sorting numbers."}, "data": {"items": ["76", "67", "77", "66"], "categories": ["Tens digit is 6", "Tens digit is 7"]}, "correct": {"Tens digit is 6": ["67", "66"], "Tens digit is 7": ["76", "77"]}},
                        {"id": "d1_l2_q20", "type": "drag-drop-sort", "prompt": "Sort the numbers.", "visual": {"type": "none", "description": "Sorting numbers."}, "data": {"items": ["30", "3", "13", "31"], "categories": ["Has 3 tens", "Has 3 ones"]}, "correct": {"Has 3 tens": ["30", "31"], "Has 3 ones": ["3", "13"]}}
                    ],
                    "level3": [
                        {"id": "d1_l3_q1", "type": "mc", "prompt": "A monster is thinking of a 2-digit number. The tens digit is one less than the ones digit. The number is greater than 80. What is the number?", "visual": {"type": "none", "description": "A complex number riddle."}, "data": {"options": ["78", "89", "98"]}, "correct": "89"},
                        {"id": "d1_l3_q2", "type": "mc", "prompt": "If you have 5 tens rods, how many ones cubes do you need to add to make the number 73?", "visual": {"type": "none", "description": "A multi-step problem."}, "data": {"options": ["23", "73", "20"]}, "correct": "23"},
                        {"id": "d1_l3_q3", "type": "mc", "prompt": "I am a number less than 100. My tens digit is an even number. My ones digit is 3 more than my tens digit. The sum of my digits is 7. What number am I?", "visual": {"type": "none", "description": "A riddle with distractor info."}, "data": {"options": ["25", "47", "69"]}, "correct": "25"},
                        {"id": "d1_l3_q4", "type": "mc", "prompt": "Which of these represents the largest value?", "visual": {"type": "none", "description": "Comparing different representations."}, "data": {"options": ["8 tens and 11 ones", "9 tens and 0 ones", "7 tens and 22 ones"]}, "correct": "7 tens and 22 ones"},
                        {"id": "d1_l3_q5", "type": "mc", "prompt": "A monster has 9 bags of ten monster eyes. He uses 2 full bags and then finds 5 loose eyes. How many eyes does he have now?", "visual": {"type": "none", "description": "A word problem with extra info."}, "data": {"options": ["75", "95", "25"]}, "correct": "75"},
                        {"id": "d1_l3_q6", "type": "evidence-based", "prompt": {"part_a": "Is it possible to show the number 54 using only 4 tens rods?", "part_b": "Which statement explains why?"}, "visual": {"type": "none", "description": "A reasoning problem."}, "data": {"options_a": ["Yes", "No"], "options_b": ["Because you would need 14 ones cubes.", "Because 54 has a 5 in the tens place.", "Because 4 tens is only 40."]}, "correct": {"part_a": "Yes", "part_b": "Because you would need 14 ones cubes."}},
                        {"id": "d1_l3_q7", "type": "evidence-based", "prompt": {"part_a": "A monster says the number 38 has a total of 11 tens and ones (3+8=11). Is this a correct way to think about the value?", "part_b": "Which statement best explains the value?"}, "visual": {"type": "none", "description": "A conceptual problem."}, "data": {"options_a": ["Yes, it's a good shortcut.", "No, it's misleading."], "options_b": ["The value is 3+8.", "The value is 30+8.", "The value is 80+3."]}, "correct": {"part_a": "No, it's misleading.", "part_b": "The value is 30+8."}},
                        {"id": "d1_l3_q8", "type": "evidence-based", "prompt": {"part_a": "Which number is represented by 6 tens and 17 ones?", "part_b": "How can this number also be represented?"}, "visual": {"type": "none", "description": "A regrouping problem."}, "data": {"options_a": ["67", "77", "176"], "options_b": ["7 tens and 7 ones", "6 tens and 7 ones", "8 tens and 7 ones"]}, "correct": {"part_a": "77", "part_b": "7 tens and 7 ones"}},
                        {"id": "d1_l3_q9", "type": "evidence-based", "prompt": {"part_a": "Look at the number 91. If we swap the digits, we get 19. Did the value of the number increase or decrease?", "part_b": "Why?"}, "visual": {"type": "none", "description": "A digit-swapping problem."}, "data": {"options_a": ["Increase", "Decrease"], "options_b": ["Because 9 tens is more than 1 ten.", "Because 9 ones is more than 1 one.", "Because the digits are the same."]}, "correct": {"part_a": "Decrease", "part_b": "Because 9 tens is more than 1 ten."}},
                        {"id": "d1_l3_q10", "type": "evidence-based", "prompt": {"part_a": "A monster has a number where the tens digit and ones digit are the same. The number is between 50 and 60. What is the number?", "part_b": "What is the total value of this number?"}, "visual": {"type": "none", "description": "A riddle."}, "data": {"options_a": ["50", "66", "55"], "options_b": ["5 tens and 5 ones", "5 tens and 0 ones", "6 tens and 6 ones"]}, "correct": {"part_a": "55", "part_b": "5 tens and 5 ones"}},
                        {"id": "d1_l3_q11", "type": "constructed-response", "prompt": "Explain why the 2 in 27 has a different value than the 2 in 72. Use the words 'tens' and 'ones' in your answer.", "visual": {"type": "none", "description": "A justification problem."}, "data": {}, "correct": "In 27, the 2 is in the tens place, so its value is 20. In 72, the 2 is in the ones place, so its value is 2."},
                        {"id": "d1_l3_q12", "type": "constructed-response", "prompt": "A monster says that 4 tens and 13 ones is the same as 5 tens and 3 ones. Is the monster correct? Explain your thinking.", "visual": {"type": "none", "description": "An explanation problem."}, "data": {}, "correct": "Yes, the monster is correct. 13 ones can be regrouped into 1 ten and 3 ones. Adding that 1 ten to the original 4 tens makes 5 tens. So both represent the number 53."},
                        {"id": "d1_l3_q13", "type": "constructed-response", "prompt": "Create a 2-digit number where the digit in the tens place is 4 more than the digit in the ones place. Explain how you found your number.", "visual": {"type": "none", "description": "A creation problem."}, "data": {}, "correct": "An example is 62. I chose 2 for the ones place. Then I added 4 to get the tens place digit, which is 6. So the number is 62."},
                        {"id": "d1_l3_q14", "type": "constructed-response", "prompt": "How many different 2-digit numbers can you make using only the digits 3 and 8? What are the numbers and what is the value of the 8 in each number?", "visual": {"type": "none", "description": "A combination problem."}, "data": {}, "correct": "You can make two numbers: 38 and 83. In 38, the value of the 8 is 8. In 83, the value of the 8 is 80."},
                        {"id": "d1_l3_q15", "type": "constructed-response", "prompt": "Describe a situation where you might need to understand place value in the real world.", "visual": {"type": "none", "description": "A real-world application problem."}, "data": {}, "correct": "When you are using money. A $10 bill is like a ten, and a $1 coin is like a one. You need to know the difference to pay for things correctly."},
                        {"id": "d1_l3_q16", "type": "tech-enhanced", "prompt": "Create a sequence of three numbers where each number increases by 10. Start with the number 17.", "visual": {"type": "none", "description": "A sequence creation problem."}, "data": {"type": "sequence"}, "correct": ["17", "27", "37"]},
                        {"id": "d1_l3_q17", "type": "tech-enhanced", "prompt": "Label the place value chart to correctly show the number 85.", "visual": {"type": "none", "description": "A labeling problem."}, "data": {"type": "label-diagram", "image": "place-value-chart-empty", "labels": {"tens": "8", "ones": "5"}}, "correct": {"tens": "8", "ones": "5"}},
                        {"id": "d1_l3_q18", "type": "tech-enhanced", "prompt": "Create the largest possible 2-digit number where the sum of the digits is 10.", "visual": {"type": "none", "description": "A number creation problem."}, "data": {"type": "number-builder"}, "correct": "91"},
                        {"id": "d1_l3_q19", "type": "tech-enhanced", "prompt": "Use a number line to show how to get from 40 to 45. What do you add?", "visual": {"type": "none", "description": "A number line problem."}, "data": {"type": "number-line-jump"}, "correct": "Add 5 ones."},
                        {"id": "d1_l3_q20", "type": "tech-enhanced", "prompt": "Create the smallest 2-digit number using two different even digits.", "visual": {"type": "none", "description": "A number creation problem with constraints."}, "data": {"type": "number-builder"}, "correct": "20"}
                    ]
                }
            },
            "day2": {
                "lesson": {
                    "title": "Monster Word Wizards!",
                    "standard": "3.NR.1.1: Read, write, and represent whole numbers in standard form, word form, and expanded form.",
                    "objectives": ["Students will be able to write numbers in standard, word, and expanded form.", "Students will be able to convert numbers between the three forms.", "I can write numbers in different ways."],
                    "vocabulary": { "Standard Form": "Writing a number using digits (e.g., 52).", "Word Form": "Writing a number using words (e.g., fifty-two).", "Expanded Form": "Writing a number to show the value of each digit (e.g., 50 + 2)." },
                    "hook": { "description": "Show a monster chef with a recipe that says 'Add twenty-four monster eyeballs.' Ask students: 'How would the monster write that number down if he only had a small space on his notepad? How could he write it to show exactly how many tens and ones he needs?'", "questions": ["Why is it useful to have different ways to write the same number?", "Have you ever seen numbers written as words? Where?"] },
                    "i_do": [
                        { "id": "d2_i_do_1", "type": "demonstration", "prompt": "Write '78' on the board. Think aloud: 'This is standard form. To write it in word form, I say the number out loud: seventy-eight. I write that down. For expanded form, I look at the place value. The 7 is 70. The 8 is 8. So I write 70 + 8.'", "visual": {"type": "none", "description": "The number 78."} },
                        { "id": "d2_i_do_2", "type": "demonstration", "prompt": "Write 'thirty-five' on the board. Think aloud: 'This is word form. 'Thirty' tells me there are 3 tens. 'Five' tells me there are 5 ones. So the standard form is 35. The expanded form would be 30 + 5.'", "visual": {"type": "none", "description": "The words thirty-five."} },
                        { "id": "d2_i_do_3", "type": "demonstration", "prompt": "Write '90 + 1' on the board. Think aloud: 'This is expanded form. It's showing me the value of each part. 90 is nine tens. 1 is one one. I just put them together to get the standard form: 91. The word form is ninety-one.'", "visual": {"type": "none", "description": "The expression 90 + 1."} }
                    ],
                    "we_do": [
                        { "id": "d2_w_do_1", "type": "mc", "prompt": "What is the standard form of 'forty-seven'?", "visual": {"type": "none", "description": "The words forty-seven."}, "data": {"options": ["407", "74", "47"]}, "correct": "47" },
                        { "id": "d2_w_do_2", "type": "mc", "prompt": "How do you write 62 in expanded form?", "visual": {"type": "none", "description": "The number 62."}, "data": {"options": ["6 + 2", "60 + 2", "60 + 20"]}, "correct": "60 + 2" },
                        { "id": "d2_w_do_3", "type": "mc", "prompt": "What is the word form of 99?", "visual": {"type": "none", "description": "The number 99."}, "data": {"options": ["Ninety", "Nine-nine", "Ninety-nine"]}, "correct": "Ninety-nine" },
                        { "id": "d2_w_do_4", "type": "mc", "prompt": "What number is 50 + 3?", "visual": {"type": "none", "description": "The expression 50 + 3."}, "data": {"options": ["53", "503", "8"]}, "correct": "53" },
                        { "id": "d2_w_do_5", "type": "mc", "prompt": "Which is the correct word form for 13?", "visual": {"type": "none", "description": "The number 13."}, "data": {"options": ["Thirteen", "Thirty-one", "Tenteen"]}, "correct": "Thirteen" },
                        { "id": "d2_w_do_6", "type": "mc", "prompt": "A monster has eighty-one coins. How do you write that in standard form?", "visual": {"type": "none", "description": "The words eighty-one."}, "data": {"options": ["18", "81", "801"]}, "correct": "81" },
                        { "id": "d2_w_do_7", "type": "mc", "prompt": "What is the expanded form of 20?", "visual": {"type": "none", "description": "The number 20."}, "data": {"options": ["2 + 0", "20 + 0", "20"]}, "correct": "20 + 0" },
                        { "id": "d2_w_do_8", "type": "mc", "prompt": "What number is 'twenty-six'?", "visual": {"type": "none", "description": "The words twenty-six."}, "data": {"options": ["62", "26", "206"]}, "correct": "26" },
                        { "id": "d2_w_do_9", "type": "mc", "prompt": "How do you write 70 + 0 in standard form?", "visual": {"type": "none", "description": "The expression 70 + 0."}, "data": {"options": ["7", "70", "700"]}, "correct": "70" },
                        { "id": "d2_w_do_10", "type": "mc", "prompt": "What is the word form of 50?", "visual": {"type": "none", "description": "The number 50."}, "data": {"options": ["Five-zero", "Fivety", "Fifty"]}, "correct": "Fifty" }
                    ],
                    "you_do": [
                        { "id": "d2_y_do_1", "type": "text-box", "prompt": "Write 85 in word form.", "visual": {"type": "none", "description": "The number 85."}, "data": {"size": 20}, "correct": "eighty-five" },
                        { "id": "d2_y_do_2", "type": "text-box", "prompt": "Write 90 + 6 in standard form.", "visual": {"type": "none", "description": "The expression 90 + 6."}, "data": {"size": 5}, "correct": "96" },
                        { "id": "d2_y_do_3", "type": "text-box", "prompt": "Write 44 in expanded form.", "visual": {"type": "none", "description": "The number 44."}, "data": {"size": 10}, "correct": "40 + 4" },
                        { "id": "d2_y_do_4", "type": "text-box", "prompt": "Write 'seventeen' in standard form.", "visual": {"type": "none", "description": "The word seventeen."}, "data": {"size": 5}, "correct": "17" },
                        { "id": "d2_y_do_5", "type": "text-box", "prompt": "A monster is 30 + 9 years old. How old is he?", "visual": {"type": "none", "description": "The expression 30 + 9."}, "data": {"size": 5}, "correct": "39" }
                    ],
                    "closure": { "description": "Review the 'I can' statement. Have students complete a '3-2-1' exit ticket: Write 3 numbers in standard form, 2 numbers in word form, and 1 number in expanded form.", "exit_ticket": "Write the number 68 in all three forms: standard, word, and expanded." },
                    "materials": ["Whiteboard/Smartboard", "Markers", "Chart paper with 'Standard', 'Word', 'Expanded' columns", "Student notebooks or whiteboards"]
                },
                "practice": {
                    "level1": [], "level2": [], "level3": [] // Placeholder, would be filled with 20 questions each
                }
            },
            "day3": {
                "lesson": {
                    "title": "Monster Munch: Comparing Numbers!",
                    "standard": "3.NR.1.3: Compare two whole numbers based on the place value of the digits using the symbols >, <, and =.",
                    "objectives": ["Students will be able to use the symbols >, <, and = to compare two-digit numbers.", "Students will be able to explain their comparison by referring to place value.", "I can use >, <, and = to compare numbers."],
                    "vocabulary": { "Greater Than (>)": "The symbol used when the first number is larger than the second.", "Less Than (<)": "The symbol used when the first number is smaller than the second.", "Equal To (=)": "The symbol used when both numbers have the same value." },
                    "hook": { "description": "Show a picture of two monsters, each with a plate of cookies. One has 27 cookies, the other has 31. Ask: 'Which monster would you rather be and why? How can we show which number is bigger using math symbols?' Introduce the 'hungry monster/alligator' mouth that always wants to eat the bigger number.", "questions": ["How do you know if one number is bigger than another?", "Does it matter which number you look at first?"] },
                    "i_do": [
                        { "id": "d3_i_do_1", "type": "demonstration", "prompt": "Write '45 __ 54' on the board. Think aloud: 'First, I look at the tens place. 45 has a 4 in the tens place. 54 has a 5. Since 5 tens is more than 4 tens, 54 is the bigger number. The hungry monster mouth opens to the 54. So, 45 < 54.'", "visual": {"type": "comparison", "description": "45 and 54"} },
                        { "id": "d3_i_do_2", "type": "demonstration", "prompt": "Write '68 __ 62' on the board. Think aloud: 'I look at the tens place. They both have a 6! They are the same. So now I have to look at the ones place. 68 has an 8. 62 has a 2. 8 is bigger than 2, so 68 is greater than 62. 68 > 62.'", "visual": {"type": "comparison", "description": "68 and 62"} },
                        { "id": "d3_i_do_3", "type": "demonstration", "prompt": "Write '70 __ 70' on the board. Think aloud: 'The tens are the same, they're both 7. The ones are the same, they're both 0. So these numbers are the same value. They are equal. 70 = 70.'", "visual": {"type": "comparison", "description": "70 and 70"} }
                    ],
                    "we_do": [
                        { "id": "d3_w_do_1", "type": "mc", "prompt": "Choose the correct symbol: 21 __ 12", "visual": {"type": "comparison", "description": "21 and 12"}, "data": {"options": [">", "<", "="]}, "correct": ">" },
                        { "id": "d3_w_do_2", "type": "mc", "prompt": "Choose the correct symbol: 88 __ 99", "visual": {"type": "comparison", "description": "88 and 99"}, "data": {"options": [">", "<", "="]}, "correct": "<" },
                        { "id": "d3_w_do_3", "type": "mc", "prompt": "Choose the correct symbol: 50 __ 50", "visual": {"type": "comparison", "description": "50 and 50"}, "data": {"options": [">", "<", "="]}, "correct": "=" },
                        { "id": "d3_w_do_4", "type": "mc", "prompt": "Choose the correct symbol: 76 __ 73", "visual": {"type": "comparison", "description": "76 and 73"}, "data": {"options": [">", "<", "="]}, "correct": ">" },
                        { "id": "d3_w_do_5", "type": "mc", "prompt": "Choose the correct symbol: 19 __ 91", "visual": {"type": "comparison", "description": "19 and 91"}, "data": {"options": [">", "<", "="]}, "correct": "<" },
                        { "id": "d3_w_do_6", "type": "mc", "prompt": "Which statement is true?", "visual": {"type": "none", "description": "Comparison statements."}, "data": {"options": ["34 > 43", "34 < 43", "34 = 43"]}, "correct": "34 < 43" },
                        { "id": "d3_w_do_7", "type": "mc", "prompt": "Which statement is false?", "visual": {"type": "none", "description": "Comparison statements."}, "data": {"options": ["10 < 100", "15 > 14", "22 < 20"]}, "correct": "22 < 20" },
                        { "id": "d3_w_do_8", "type": "mc", "prompt": "A monster has 45 rocks. His friend has 45 rocks. Compare their rocks.", "visual": {"type": "none", "description": "Word problem."}, "data": {"options": ["45 > 45", "45 < 45", "45 = 45"]}, "correct": "45 = 45" },
                        { "id": "d3_w_do_9", "type": "mc", "prompt": "Choose the correct symbol: 9 __ 10", "visual": {"type": "comparison", "description": "9 and 10"}, "data": {"options": [">", "<", "="]}, "correct": "<" },
                        { "id": "d3_w_do_10", "type": "mc", "prompt": "Choose the correct symbol: 87 __ 78", "visual": {"type": "comparison", "description": "87 and 78"}, "data": {"options": [">", "<", "="]}, "correct": ">" }
                    ],
                    "you_do": [
                        { "id": "d3_y_do_1", "type": "text-box", "prompt": "Write the symbol to compare: 67 __ 76", "visual": {"type": "comparison", "description": "67 and 76"}, "data": {"size": 2}, "correct": "<" },
                        { "id": "d3_y_do_2", "type": "text-box", "prompt": "Write the symbol to compare: 30 __ 29", "visual": {"type": "comparison", "description": "30 and 29"}, "data": {"size": 2}, "correct": ">" },
                        { "id": "d3_y_do_3", "type": "text-box", "prompt": "Write a number that is greater than 88.", "visual": {"type": "none", "description": "Number greater than 88."}, "data": {"size": 5}, "correct": "89" },
                        { "id": "d3_y_do_4", "type": "text-box", "prompt": "Write a number that makes this true: 55 > __", "visual": {"type": "none", "description": "Number less than 55."}, "data": {"size": 5}, "correct": "54" },
                        { "id": "d3_y_do_5", "type": "text-box", "prompt": "Is 12 > 21? (yes/no)", "visual": {"type": "none", "description": "Is 12 greater than 21?"}, "data": {"size": 5}, "correct": "no" }
                    ],
                    "closure": { "description": "Review the 'I can' statement. Ask students to stand up. Call out two numbers. If the first number is greater, they should make a '>' symbol with their arms. If it's less, a '<' symbol.", "exit_ticket": "Write three comparison statements on a sticky note: one using >, one using <, and one using =." },
                    "materials": ["Whiteboard/Smartboard", "Markers", "Comparison symbols anchor chart (>, <, =)", "Number cards"]
                },
                "practice": {
                    "level1": [], "level2": [], "level3": [] // Placeholder
                }
            },
            "day4": {
                "lesson": {
                    "title": "Monster Line-Up!",
                    "standard": "3.NR.1.3 (subset): Order whole numbers up to 100.",
                    "objectives": ["Students will be able to order a set of numbers from least to greatest.", "Students will be able to order a set of numbers from greatest to least.", "I can put numbers in order."],
                    "vocabulary": { "Order": "To arrange numbers in a sequence.", "Least": "The smallest number in a set.", "Greatest": "The largest number in a set." },
                    "hook": { "description": "Show a picture of three monsters who ran a race. Their race times were 45 seconds, 38 seconds, and 51 seconds. Ask: 'Who came in first place? Who came in last? How do you know?' (Note: lowest time is first place).", "questions": ["How is ordering numbers similar to comparing them?", "What is a real-life situation where you need to put things in order?"] },
                    "i_do": [
                        { "id": "d4_i_do_1", "type": "demonstration", "prompt": "Write '56, 23, 65' on the board. Think aloud: 'I need to order these from least to greatest. I'll look at the tens place first: 5, 2, 6. The smallest ten is 2, so 23 is the smallest number. Then comes 5, so 56 is next. The largest ten is 6, so 65 is the greatest. The order is 23, 56, 65.'", "visual": {"type": "none", "description": "Numbers 56, 23, 65."} },
                        { "id": "d4_i_do_2", "type": "demonstration", "prompt": "Write '78, 71, 75'. Think aloud: 'I want to order these from greatest to least. The tens are all 7, so I have to look at the ones: 8, 1, 5. The greatest one is 8, so 78 is the greatest number. Next is 5, so 75 is next. The least one is 1, so 71 is last. The order is 78, 75, 71.'", "visual": {"type": "none", "description": "Numbers 78, 71, 75."} },
                        { "id": "d4_i_do_3", "type": "demonstration", "prompt": "Write '40, 9, 14'. Think aloud: 'Least to greatest. I have to be careful here. 40 has 4 tens. 9 has 0 tens. 14 has 1 ten. The smallest is 0 tens, so 9 is first. Then 1 ten, so 14 is next. Then 4 tens, so 40 is last. The order is 9, 14, 40.'", "visual": {"type": "none", "description": "Numbers 40, 9, 14."} }
                    ],
                    "we_do": [
                        { "id": "d4_w_do_1", "type": "mc", "prompt": "Order from least to greatest: 10, 5, 15", "visual": {"type": "none", "description": ""}, "data": {"options": ["5, 10, 15", "15, 10, 5", "10, 5, 15"]}, "correct": "5, 10, 15" },
                        { "id": "d4_w_do_2", "type": "mc", "prompt": "Order from greatest to least: 82, 28, 80", "visual": {"type": "none", "description": ""}, "data": {"options": ["28, 80, 82", "82, 80, 28", "80, 82, 28"]}, "correct": "82, 80, 28" },
                        { "id": "d4_w_do_3", "type": "mc", "prompt": "What number comes next? 25, 30, 35, __", "visual": {"type": "none", "description": ""}, "data": {"options": ["36", "40", "34"]}, "correct": "40" },
                        { "id": "d4_w_do_4", "type": "mc", "prompt": "Which number is the greatest? 91, 19, 90", "visual": {"type": "none", "description": ""}, "data": {"options": ["19", "90", "91"]}, "correct": "91" },
                        { "id": "d4_w_do_5", "type": "mc", "prompt": "Which number is the least? 66, 60, 6", "visual": {"type": "none", "description": ""}, "data": {"options": ["6", "60", "66"]}, "correct": "6" },
                        { "id": "d4_w_do_6", "type": "mc", "prompt": "Order from least to greatest: 44, 49, 41", "visual": {"type": "none", "description": ""}, "data": {"options": ["49, 44, 41", "41, 44, 49", "44, 41, 49"]}, "correct": "41, 44, 49" },
                        { "id": "d4_w_do_7", "type": "mc", "prompt": "What number is missing? 50, __, 70, 80", "visual": {"type": "none", "description": ""}, "data": {"options": ["55", "65", "60"]}, "correct": "60" },
                        { "id": "d4_w_do_8", "type": "mc", "prompt": "Order from greatest to least: 9, 99, 19", "visual": {"type": "none", "description": ""}, "data": {"options": ["99, 19, 9", "9, 19, 99", "19, 9, 99"]}, "correct": "99, 19, 9" },
                        { "id": "d4_w_do_9", "type": "mc", "prompt": "Three monsters have scores: 52, 25, 55. What is the highest score?", "visual": {"type": "none", "description": ""}, "data": {"options": ["52", "25", "55"]}, "correct": "55" },
                        { "id": "d4_w_do_10", "type": "mc", "prompt": "What is the correct order? (least to greatest)", "visual": {"type": "none", "description": ""}, "data": {"options": ["31, 13, 33", "13, 31, 33", "33, 31, 13"]}, "correct": "13, 31, 33" }
                    ],
                    "you_do": [
                        { "id": "d4_y_do_1", "type": "text-box", "prompt": "Order from least to greatest: 81, 18, 80", "visual": {"type": "none", "description": ""}, "data": {"size": 15}, "correct": "18, 80, 81" },
                        { "id": "d4_y_do_2", "type": "text-box", "prompt": "Order from greatest to least: 27, 72, 22", "visual": {"type": "none", "description": ""}, "data": {"size": 15}, "correct": "72, 27, 22" },
                        { "id": "d4_y_do_3", "type": "text-box", "prompt": "What is the smallest number you can make with the digits 5 and 9?", "visual": {"type": "none", "description": ""}, "data": {"size": 5}, "correct": "59" },
                        { "id": "d4_y_do_4", "type": "text-box", "prompt": "List three numbers that are between 30 and 40 in order from least to greatest.", "visual": {"type": "none", "description": ""}, "data": {"size": 15}, "correct": "31, 32, 33" },
                        { "id": "d4_y_do_5", "type": "text-box", "prompt": "What is the largest number in this set: 6, 66, 16?", "visual": {"type": "none", "description": ""}, "data": {"size": 5}, "correct": "66" }
                    ],
                    "closure": { "description": "Review the 'I can' statement. Give each student a card with a 2-digit number. Have them get up and arrange themselves in a line from least to greatest without talking.", "exit_ticket": "Order the following numbers from greatest to least: 48, 84, 4, 80." },
                    "materials": ["Whiteboard/Smartboard", "Markers", "Number cards (0-100)", "Student whiteboards"]
                },
                "practice": {
                    "level1": [], "level2": [], "level3": [] // Placeholder
                }
            }
        };
        
        lessonBlueprint.day1 = fullBlueprint.day1;
        lessonBlueprint.day2 = fullBlueprint.day2;
        lessonBlueprint.day3 = fullBlueprint.day3;
        lessonBlueprint.day4 = fullBlueprint.day4;
        
        loadState();
        
        // Attach the single, delegated event listener
        document.getElementById('app-container').addEventListener('click', handleAppClick);
        
        // Setup drag-and-drop listeners (delegated from a suitable parent)
        const contentArea = document.getElementById('content-area');
        contentArea.addEventListener('dragstart', handleDragStart);
        contentArea.addEventListener('dragover', handleDragOver);
        contentArea.addEventListener('drop', handleDrop);
        contentArea.addEventListener('touchstart', handleTouchStart, {passive: false});
        contentArea.addEventListener('touchmove', handleTouchMove, {passive: false});
        contentArea.addEventListener('touchend', handleTouchEnd);


        renderUI();
    }

    // --- RENDERING LOGIC ---
    function renderUI() {
        renderHeader();
        renderContent();
        renderFooter();
        saveState();
    }

    function renderHeader() {
        const dayTabsContainer = document.getElementById('day-tabs');
        let tabsHtml = '';
        for (let i = 1; i <= 4; i++) {
            const isActive = appState.currentDay === i;
            const isDisabled = !lessonBlueprint[`day${i}`];
            tabsHtml += `<button data-action="set-day" data-day="${i}" class="day-tab-btn flex-grow text-center font-bold p-3 rounded-t-lg transition-all ${isActive ? 'tab-active' : 'text-gray-500 hover:bg-gray-200'} ${isDisabled ? 'opacity-50 cursor-not-allowed' : ''}" ${isDisabled ? 'disabled' : ''}>Day ${i}</button>`;
        }
        dayTabsContainer.innerHTML = tabsHtml;

        const modeSwitcherContainer = document.getElementById('mode-switcher');
        let modeHtml = '';
        if (appState.currentMode === 'lesson') {
            modeHtml = `<button data-action="switch-mode" data-mode="practice" class="px-4 py-2 bg-green-500 text-white font-bold rounded-lg shadow hover:bg-green-600 transition-all">Go to Practice ðŸ‘¾</button>`;
        } else { // practice mode
            modeHtml = `<button data-action="switch-mode" data-mode="lesson" class="px-4 py-2 bg-purple-500 text-white font-bold rounded-lg shadow hover:bg-purple-600 transition-all">Back to Lesson ðŸ“–</button>`;
        }
        modeHtml += `<button data-action="download-work" class="px-4 py-2 bg-gray-500 text-white font-bold rounded-lg shadow hover:bg-gray-600 transition-all">Save HTML</button>`;
        modeSwitcherContainer.innerHTML = modeHtml;
    }

    function renderContent() {
        const contentArea = document.getElementById('content-area');
        contentArea.innerHTML = ''; // Clear previous content

        const dayData = lessonBlueprint[`day${appState.currentDay}`];
        if (!dayData) {
            contentArea.innerHTML = `<p class="text-center text-gray-500">Lesson data for Day ${appState.currentDay} is not available yet.</p>`;
            return;
        }

        if (appState.currentMode === 'lesson') {
            renderLesson(dayData.lesson);
        } else { // practice mode
            if (appState.practice.currentLevel === null) {
                renderPracticeLevelSelector();
            } else {
                renderPracticeQuestion(dayData.practice);
            }
        }
    }

    function renderLesson(lessonData) {
        const contentArea = document.getElementById('content-area');
        const allSlides = [
            { type: 'title', data: lessonData },
            { type: 'hook', data: lessonData.hook },
            ...lessonData.i_do.map(item => ({ type: 'i_do', data: item })),
            ...lessonData.we_do.map(item => ({ type: 'we_do', data: item })),
            ...lessonData.you_do.map(item => ({ type: 'you_do', data: item })),
            { type: 'closure', data: lessonData.closure }
        ];

        currentSlideData = allSlides[appState.currentSlide];
        let html = '';
        let hasVisual = false;

        switch (currentSlideData.type) {
            case 'title':
                html = `
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-purple-600 mb-2">${currentSlideData.data.title}</h2>
                        <p class="text-lg text-gray-600 mb-4">Standard: ${currentSlideData.data.standard}</p>
                        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg text-left">
                            <h3 class="font-bold text-xl mb-2">Today's Goals:</h3>
                            <ul class="list-disc list-inside">
                                ${currentSlideData.data.objectives.map(obj => `<li>${obj}</li>`).join('')}
                            </ul>
                        </div>
                    </div>`;
                break;
            case 'hook':
                html = `
                    <div class="text-left">
                        <h2 class="text-3xl font-bold text-purple-600 mb-4">Hook (5 mins)</h2>
                        <p class="text-lg mb-4">${currentSlideData.data.description}</p>
                        <h3 class="font-bold text-xl mb-2">Questions:</h3>
                        <ul class="list-disc list-inside text-lg">
                            ${currentSlideData.data.questions.map(q => `<li>${q}</li>`).join('')}
                        </ul>
                    </div>`;
                break;
            case 'closure':
                 html = `
                    <div class="text-left">
                        <h2 class="text-3xl font-bold text-purple-600 mb-4">Closure & Assessment (5 mins)</h2>
                        <p class="text-lg mb-4">${currentSlideData.data.description}</p>
                        <div class="mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg">
                            <h3 class="font-bold text-xl text-yellow-800">Exit Ticket:</h3>
                            <p class="text-lg text-yellow-900">${currentSlideData.data.exit_ticket}</p>
                        </div>
                    </div>`;
                break;
            default: // This now correctly handles i_do, we_do, you_do
                html = renderQuestionSlide(currentSlideData.data, `${currentSlideData.type.replace('_', ' ')}`);
                hasVisual = true; // Mark that this slide might have a visual
                break;
        }
        
        contentArea.innerHTML = html;

        if (hasVisual) {
            const visualContainer = document.getElementById('visual-container');
            const svg = generateVisual(currentSlideData.data.visual);
            if (svg && visualContainer) {
                visualContainer.appendChild(svg);
            }
        }
        
        updateFooterNav(allSlides.length);
    }

    function renderPracticeLevelSelector() {
        const contentArea = document.getElementById('content-area');
        contentArea.innerHTML = `
            <div class="text-center">
                <h2 class="text-3xl font-bold text-green-600 mb-6">ðŸ‘¾ Practice Center ðŸ‘¾</h2>
                <p class="text-lg text-gray-700 mb-8">Choose your challenge level, little monster!</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <button data-action="select-level" data-level="1" class="p-8 bg-yellow-100 text-yellow-800 rounded-xl shadow-lg hover:scale-105 transition-transform">
                        <h3 class="text-2xl font-bold mb-2">Level 1</h3>
                        <p>Approaching</p>
                    </button>
                    <button data-action="select-level" data-level="2" class="p-8 bg-green-100 text-green-800 rounded-xl shadow-lg hover:scale-105 transition-transform">
                        <h3 class="text-2xl font-bold mb-2">Level 2</h3>
                        <p>On Level</p>
                    </button>
                    <button data-action="select-level" data-level="3" class="p-8 bg-blue-100 text-blue-800 rounded-xl shadow-lg hover:scale-105 transition-transform">
                        <h3 class="text-2xl font-bold mb-2">Level 3</h3>
                        <p>Exceeding</p>
                    </button>
                </div>
            </div>
        `;
        document.getElementById('footer-nav').classList.add('hidden');
    }

    function renderPracticeQuestion(practiceData) {
        const contentArea = document.getElementById('content-area');
        const level = appState.practice.currentLevel;
        const questions = practiceData[`level${level}`];

        if (!questions || questions.length === 0) {
            contentArea.innerHTML = `<p class="text-center text-gray-500">Practice questions for this level are not available yet. Please go back.</p>`;
            document.getElementById('footer-nav').classList.add('hidden');
            return;
        }

        const progress = appState.practice[appState.currentDay][level].progress;
        
        currentSlideData = questions[progress];
        
        const html = renderQuestionSlide(currentSlideData, `Level ${level} Question ${progress + 1} of ${questions.length}`);
        contentArea.innerHTML = html;

        const visualContainer = document.getElementById('visual-container');
        const svg = generateVisual(currentSlideData.visual);
        if (svg) {
            visualContainer.appendChild(svg);
        }
        
        document.getElementById('footer-nav').classList.remove('hidden');
        updateFooterNav(questions.length, true);
    }


    function renderQuestionSlide(q, title) {
        let optionsHtml = '';
        let promptText = typeof q.prompt === 'string' ? q.prompt : `<strong>Part A:</strong> ${q.prompt.part_a}<br><strong>Part B:</strong> ${q.prompt.part_b}`;

        switch(q.type) {
            case 'mc':
            case 'true-false':
                optionsHtml = q.data.options.map(opt => `<button data-action="select-option" class="w-full text-left p-4 border-2 border-gray-300 rounded-lg hover:bg-blue-100 hover:border-blue-400 transition-all">${opt}</button>`).join('');
                break;
            case 'drag-drop-match':
                optionsHtml = `
                    <div class="flex flex-col md:flex-row gap-8 justify-center">
                        <div class="flex flex-col gap-4 items-center">
                            <h4 class="font-bold">Items</h4>
                            <div id="draggables-container" class="flex flex-col gap-2">
                            ${q.data.draggables.map(item => `<div class="p-4 bg-blue-200 rounded-lg cursor-grab no-select" draggable="true" data-drag-item="${item}">${item}</div>`).join('')}
                            </div>
                        </div>
                        <div class="flex flex-col gap-4 items-center">
                            <h4 class="font-bold">Categories</h4>
                            ${q.data.dropTargets.map(target => `<div class="p-4 w-48 h-20 bg-gray-200 border-2 border-dashed border-gray-400 rounded-lg flex items-center justify-center" data-drop-target="${target}">${target}</div>`).join('')}
                        </div>
                    </div>
                `;
                break;
            // Add more cases for other question types here
        }

        return `
            <div class="flex flex-col h-full">
                <p class="font-bold text-lg text-gray-500 uppercase">${title}</p>
                <div class="text-2xl my-4 flex-shrink-0">${promptText}</div>
                <div id="visual-container" class="flex-grow flex items-center justify-center min-h-[100px]"></div>
                <div id="options-container" class="space-y-4 mt-4">${optionsHtml}</div>
                <div id="feedback-container" class="mt-4"></div>
                ${q.type !== 'demonstration' ? `<button data-action="check-answer" class="mt-6 w-full sm:w-auto self-center px-8 py-4 bg-green-500 text-white font-bold rounded-lg shadow hover:bg-green-600 transition-all">Check Answer</button>` : ''}
            </div>
        `;
    }


    function renderFooter() {
        // Logic to show/hide footer is handled in content rendering functions
        const streakCounter = document.getElementById('streak-counter');
        if (appState.streak > 1) {
            streakCounter.textContent = `ðŸ”¥ Streak: ${appState.streak}`;
            streakCounter.classList.remove('hidden');
        } else {
            streakCounter.classList.add('hidden');
        }
    }

    function updateFooterNav(totalSlides, isPractice = false) {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const currentIdx = isPractice ? appState.practice[appState.currentDay][appState.practice.currentLevel].progress : appState.currentSlide;

        prevBtn.disabled = currentIdx === 0;
        nextBtn.disabled = currentIdx >= totalSlides - 1;
    }

    // --- EVENT HANDLING ---
    function handleAppClick(e) {
        const actionTarget = e.target.closest('[data-action]');
        if (!actionTarget) return;

        const action = actionTarget.dataset.action;
        
        switch(action) {
            case 'set-day':
                appState.currentDay = parseInt(actionTarget.dataset.day);
                appState.currentSlide = 0;
                appState.practice.currentLevel = null;
                renderUI();
                break;
            case 'switch-mode':
                appState.currentMode = actionTarget.dataset.mode;
                appState.currentSlide = 0;
                renderUI();
                break;
            case 'select-level':
                appState.practice.currentLevel = parseInt(actionTarget.dataset.level);
                renderUI();
                break;
            case 'next-slide':
                if (appState.currentMode === 'lesson') {
                    appState.currentSlide++;
                } else {
                    appState.practice[appState.currentDay][appState.practice.currentLevel].progress++;
                }
                renderUI();
                break;
            case 'prev-slide':
                if (appState.currentMode === 'lesson') {
                    appState.currentSlide--;
                } else {
                    appState.practice[appState.currentDay][appState.practice.currentLevel].progress--;
                }
                renderUI();
                break;
            case 'download-work':
                downloadWork();
                break;
        }
    }

    function handleDragStart(e) {
        if (e.target.dataset.dragItem) {
            draggedElement = e.target;
            e.dataTransfer.setData('text/plain', e.target.dataset.dragItem);
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }
    }

    function handleDragOver(e) {
        e.preventDefault();
        const dropTarget = e.target.closest('[data-drop-target]');
        if (dropTarget) {
            document.querySelectorAll('[data-drop-target]').forEach(el => el.classList.remove('drop-target-hover'));
            dropTarget.classList.add('drop-target-hover');
        }
    }

    function handleDrop(e) {
        e.preventDefault();
        const dropTarget = e.target.closest('[data-drop-target]');
        if (dropTarget && draggedElement) {
            // Prevent dropping multiple items on one target
            if(dropTarget.children.length === 0) {
                dropTarget.appendChild(draggedElement);
                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
        }
        document.querySelectorAll('[data-drop-target]').forEach(el => el.classList.remove('drop-target-hover'));
    }


    // Touch event handlers for drag and drop
    let touchStartElement = null;
    let touchCurrentTarget = null;

    function handleTouchStart(e) {
        if (e.target.dataset.dragItem) {
            e.preventDefault();
            touchStartElement = e.target;
            touchStartElement.classList.add('dragging');
            // Create a clone for visual feedback
            const clone = touchStartElement.cloneNode(true);
            clone.style.position = 'absolute';
            clone.style.pointerEvents = 'none';
            clone.id = 'drag-clone';
            document.body.appendChild(clone);
            updateClonePosition(e.touches[0], clone);
        }
    }

    function handleTouchMove(e) {
        if (touchStartElement) {
            e.preventDefault();
            const clone = document.getElementById('drag-clone');
            updateClonePosition(e.touches[0], clone);
            
            // Find what element we're dragging over
            clone.style.display = 'none';
            const elementBelow = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
            clone.style.display = 'block';
            
            const dropTarget = elementBelow ? elementBelow.closest('[data-drop-target]') : null;
            
            document.querySelectorAll('[data-drop-target]').forEach(el => el.classList.remove('drop-target-hover'));
            if (dropTarget) {
                dropTarget.classList.add('drop-target-hover');
                touchCurrentTarget = dropTarget;
            } else {
                touchCurrentTarget = null;
            }
        }
    }

    function handleTouchEnd(e) {
        if (touchStartElement) {
            e.preventDefault();
            const clone = document.getElementById('drag-clone');
            if (clone) clone.remove();

            if (touchCurrentTarget && touchCurrentTarget.children.length === 0) {
                touchCurrentTarget.appendChild(touchStartElement);
            }
            
            touchStartElement.classList.remove('dragging');
            document.querySelectorAll('[data-drop-target]').forEach(el => el.classList.remove('drop-target-hover'));
            
            touchStartElement = null;
            touchCurrentTarget = null;
        }
    }

    function updateClonePosition(touch, clone) {
        clone.style.left = `${touch.clientX - clone.offsetWidth / 2}px`;
        clone.style.top = `${touch.clientY - clone.offsetHeight / 2}px`;
    }


    // --- FILE SAVING ---
    function downloadWork() {
        const savedState = JSON.stringify(appState);
        const htmlContent = document.documentElement.outerHTML;

        // Create a temporary document to manipulate
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');

        // Remove any existing progress data script
        const existingScript = doc.getElementById('progress-data');
        if (existingScript) {
            existingScript.remove();
        }

        // Create the new script tag
        const scriptTag = doc.createElement('script');
        scriptTag.id = 'progress-data';
        scriptTag.type = 'application/json';
        scriptTag.textContent = savedState;

        doc.body.appendChild(scriptTag);

        const finalHtml = `<!DOCTYPE html>\n` + doc.documentElement.outerHTML;
        const blob = new Blob([finalHtml], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'monster-math-progress.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // --- KICK OFF THE APP ---
    initializeApp();
});
</script>


<script id="progress-data" type="application/json">{"currentDay":1,"currentMode":"lesson","currentSlide":0,"streak":0,"lessonProgress":{"1":0,"2":0,"3":0,"4":0},"practice":{"1":{"1":{"progress":0,"answers":{}},"2":{"progress":0,"answers":{}},"3":{"progress":0,"answers":{}}},"2":{"1":{"progress":0,"answers":{}},"2":{"progress":0,"answers":{}},"3":{"progress":0,"answers":{}}},"3":{"1":{"progress":0,"answers":{}},"2":{"progress":0,"answers":{}},"3":{"progress":0,"answers":{}}},"4":{"1":{"progress":0,"answers":{}},"2":{"progress":0,"answers":{}},"3":{"progress":0,"answers":{}}},"currentLevel":null}}</script></body></html>
